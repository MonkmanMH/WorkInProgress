---
title: "household budget R"
output: html_notebook
editor_options: 
  chunk_output_type: inline
---

This is reads in downloaded CSV files with financial transactions

* Scotiabank -- savings and chequing account

* TD Visa statement

and merges them into a single csv file that can be incorporated into a budget spreadsheet.


```{r setup}

# load packages

library(dplyr)
library(readr)

library(lubridate)

library(fuzzyjoin)


```



## Step 1: read in files

Read in TD VISA expenses, code to spending categories.


```{r}


accountactivity <- read_csv("C:/Users/User/Downloads/accountactivity.csv", 
                            col_names = c("date", "vendor", "debit", "credit", "balance")
                            )

#accountactivity <- read_csv("datafiles/accountactivity (1).csv", 
#                            col_names = c("date", "vendor", "debit", "credit", "balance"))

# resolve NA values

accountactivity$debit[is.na(accountactivity$debit)] <- 0

accountactivity$credit[is.na(accountactivity$credit)] <- 0
accountactivity$credit <- as.numeric(accountactivity$credit)

ls.str(accountactivity)

# create single column with "amount"
# filter out payments to the VISA account

accountactivity <- accountactivity %>%
  mutate(amount = debit - credit) %>%
  filter(vendor != "SCOTIABANK PAYMENT") %>%
  mutate(date = mdy(date),
         FinIn = "TDVisa")

ls.str(accountactivity)

write_csv(accountactivity, "E:/@documents/budget/pRocessing/accountactivty_test.csv")


final_accountactivity <- accountactivity %>%
  select(date, vendor, amount, FinIn)



```



```{r}

pcbanking_chequing <- read_csv("C:/Users/User/Downloads/pcbanking.csv",
                               col_names = c("date", "amount", "dash", "type", "source")
                            )

#accountactivity <- read_csv("datafiles/accountactivity (1).csv", 
#                            col_names = c("date", "vendor", "debit", "credit", "balance"))


ls.str(pcbanking_chequing)

# create single column with "amount"
# filter out payments to the VISA account

pcbanking_chequing <- pcbanking_chequing %>%
  mutate(date = mdy(date),
         FinIn = "ScotiaChequing")



ls.str(pcbanking_chequing)

write_csv(pcbanking_chequing, "E:/@documents/budget/pRocessing/pcbanking_chequing_test.csv")


final_pcbanking_chequing <- pcbanking_chequing %>%
  select(date, type, source, amount, FinIn)



ls.str(final_pcbanking_chequing)

```




## Step 2: merge the three files

Need to consolidate the "source" and "type" fields in the Scotiabank so it can merge with the "vendor" in the TD file...or is this a job for `case_when`?




## Step 3: match vendors to categories


Read in vendor to category assignment file.


```{r}

vendor_category <- read_csv("vendor-category.csv")

```




```{r}
accountactivity %>%
  fuzzyjoin::regex_inner_join(vendor_category, by = "vendor")

new_accountactivity <- accountactivity %>%
  fuzzyjoin::regex_left_join(vendor_category, by = "vendor")

# -------------------------------------------------------------
# Step 3: rearrange columns, save file


final_accountactivity <- new_accountactivity %>%
  select(category, date, vendor.x, amount)

write_csv(final_accountactivity, "final_accountactivty.csv")


# -------------------------------------------------------------

# more financial processing in R
# 
# mortgage calculator
# https://www.r-bloggers.com/mortgage-calculator-and-amortization-charts-with-r/

# empirical finance package
# https://cran.r-project.org/web/views/Finance.html

# simple amortization function
# https://www.r-bloggers.com/a-simple-amortization-function/




```




-30-