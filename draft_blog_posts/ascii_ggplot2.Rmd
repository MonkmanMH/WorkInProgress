---
title: "ascii"
author: "Martin Monkman"
date: "November 11, 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

I recently read Simon Barthelm√©'s blog post ["Generating ASCII art using imager and ggplot2"](https://dahtah.github.io/imager/ascii_art.html) on how to generate an ascii document from an image file, and thought I would give it a try.

And what better thing to use than the new hex sticker design for the [`Lahman`](https://github.com/cdalzell/Lahman) package?

Using big chunks of code copy and pasted from Simon's post, we get the following:



```{r packages}

##The tidyverse package loads dplyr, purrr, etc. 
library(tidyverse)
library(imager)
##Optional: cowplot has nicer defaults for ggplot
library(cowplot) 

# note: original code requires `gtools`
library(gtools)

```

Then, import the image:

```{r}

im <- load.image("1024px-Aster_Tataricus.jpg") 
plot(im)


im <- load.image("Fae-per bag princess.jpg") 
plot(im)

```

Then, as per Simon's code, generate a set of ASCII characters:

```{r}

asc <- gtools::chr(38:126) #We use a subset of ASCII, R doesn't render the rest
head(asc,10)

#Draw some text on a white background: 
txt <- imfill(50,50,val=1) %>% implot(text(20,20,"Blah")) 
txt

plot(txt,interp=FALSE)

```


```{r}

g.chr <- function(chr) implot(imfill(50,50,val=1),text(25,25,chr,cex=5)) %>% grayscale %>% mean

g <- map_dbl(asc,g.chr)
n <- length(g)
plot(1:n,sort(g),type="n",xlab="Order",ylab="Lightness")
text(1:n,sort(g),asc[order(g)])


```


```{r}

#Sort the characters by increasing lightness
char <- asc[order(g)]

#Convert image to grayscale, resize, convert to data.frame
d <- grayscale(im) %>% imresize(.1)  %>% as.data.frame

#Quantise
d <- mutate(d,qv=cut_number(value,n) %>% as.integer)

#Assign a character to each quantised level
d <- mutate(d,char=char[qv])

#Plot
ggplot(d,aes(x,y))+geom_text(aes(label=char),size=1)+scale_y_reverse()

```

